# Backend
## Роуты
- /docs - Документация проекта, там тестировать систему
- /admin - Админ-панель для управления с БД
- /members - Возвращает всех участников
- /events - Возвращает все события, но с коротким текстом
- /events/{id} - Вовзвращает одно событие по указанному айди с длинным текстом
- /invite - По добавлению данных, отправляет их на почту и сохраняет фото локально
---


## Гайд по запуску
1. После клонирования создавать ветку со своим ником в ТГ
2. **Требуется наличие дополнительных ПО: PostgreSQL, PGadmin4, Redis + Docker**
3. В корне backend сделать файл `.env` с содержимым:

```
POSTGRES_USER=ваш ник в бд(чаще всего postgres)
POSTGRES_PASSWORD=пароль, который ввели при скачивании (по умолчанию postgres)
POSTGRES_HOST=localhost
POSTGRES_DB=название базы данных, которую создали(проще делать в pgAdmin)
POSTGRES_PORT=5432

SMTP_HOST=smtp.gmail.com
SMTP_PORT=465
SMTP_USER=ваша почта откуда сообщение
SMTP_PASS=пароль создается после двухфакторной авторизации с добавлнием приложения

EMAIL_TO=вторая почта или первая для тестов

REDIS_HOST=localhost
REDIS_PORT=6379

MODE=DEV
LOG_LEVEL=INFO
```
4. Добавить туда свои данные БД для сверки работы
5. Создать вирутальное окружение `python3 -m venv venv`, `venv\Scripts\activate` или eсли разработка ведется в VS Code, то тыкайте на файл `requirements.txt` и соглашайтесь с установкой виртуального окружения. **В консоле/терминале потом будет писаться (venv) перед вашим путем, перед этим скачивать зависимости НЕ НАДО**
6. Далее установка, если VS Code не установил `pip install -r requirements.txt`
7. Создаем базу данных с названием, которое дали в переменной `POSTGRES_DB` в файле `.env`, если не делали этого ранее
8. Создаем папку `static` в корне проекта
9. Требуется провести миграцию до последнего обновления из корня(backend/) введите команду `alembic upgrade head`
10. Для запуска проекта из корня(backend/) введите команду `uvicorn app.main:app --reload`
11. Если вы подключили свою почту, то можете переходить к шагу 11, если нет, то роут /invite недоступен
12. Для запуска фоновой задачи с отправкой почты из корня введите команду `celery -A app.tasks.celery:celery worker --loglevel=INFO`

**ВАЖНО**
- Отправка фото ТОЛЬКО формата png и jpg, форматы svg и webp НЕ ПОДДЕРЖИВАЮТСЯ 
- Проверяйте работу Redis перед работой с проектом


## Docker
**В процессе**
</br><u>НЕ ИСПОЛЬЗОВАТЬ</u></br>
1. `docker compose build`
2. `docker compose up`
3. Остановка CTRL+C или `docker stop $(docker ps -q)`
4. Далее надо очистить для запуска новой версии `sudo docker system prune -a --volumes` - **Удаляет все образы и контейнеры на ПК, если есть нужные, тогда удалять вручную**
5. Повторять шаги с 1